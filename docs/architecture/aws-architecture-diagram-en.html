<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KnowledgeWeaver AWS Architecture</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #FF9A56 0%, #FF6A88 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #diagram {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            transform: translateY(-2px);
        }

        .node rect, .node ellipse, .node polygon {
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .node text {
            pointer-events: none;
            font-weight: 600;
        }

        .link {
            fill: none;
            stroke-width: 2.5;
            opacity: 0.7;
        }

        .link.solid {
            stroke: #FF6A88;
        }

        .link.dashed {
            stroke: #FF9A56;
            stroke-dasharray: 8, 4;
        }

        .group-box {
            fill: none;
            stroke-width: 2;
            rx: 15;
            opacity: 0.8;
        }

        .group-box.vpc {
            stroke: #232F3E;
            stroke-dasharray: 10, 5;
        }

        .group-box.subnet {
            stroke: #4A90E2;
            stroke-dasharray: 5, 3;
        }

        .group-box.services {
            stroke: #E07B39;
            stroke-dasharray: 10, 5;
        }

        .group-box.cluster {
            stroke: #FF9900;
            stroke-dasharray: 8, 4;
        }

        .group-label {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .group-label.vpc {
            fill: #232F3E;
        }

        .group-label.subnet {
            fill: #4A90E2;
        }

        .group-label.services {
            fill: #E07B39;
        }

        .group-label.cluster {
            fill: #FF9900;
        }

        .title {
            font-size: 32px;
            font-weight: 700;
            fill: #333;
            text-anchor: middle;
        }

        .subtitle {
            font-size: 16px;
            fill: #666;
            text-anchor: middle;
        }

        .arrow {
            fill: #FF6A88;
        }

        .arrow.dashed {
            fill: #FF9A56;
        }

        .aws-icon {
            font-size: 12px;
            fill: #FF9900;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div id="diagram"></div>

    <script>
        const width = 1500;
        const height = 900;

        const svg = d3.select('#diagram')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        // Define arrow markers
        svg.append('defs').selectAll('marker')
            .data(['arrow', 'arrow-dashed'])
            .enter().append('marker')
            .attr('id', d => d)
            .attr('viewBox', '0 0 10 10')
            .attr('refX', 9)
            .attr('refY', 5)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M 0 0 L 10 5 L 0 10 z')
            .attr('class', d => d === 'arrow-dashed' ? 'arrow dashed' : 'arrow');

        // Title
        svg.append('text')
            .attr('class', 'title')
            .attr('x', width / 2)
            .attr('y', 40)
            .text('KnowledgeWeaver AWS Cloud Architecture');

        svg.append('text')
            .attr('class', 'subtitle')
            .attr('x', width / 2)
            .attr('y', 65)
            .text('EKS Kubernetes Production Deployment');

        // Define colors (AWS-inspired)
        const colors = {
            // Networking
            vpc: '#232F3E',
            subnet: '#4A90E2',
            alb: '#8C4FFF',
            nat: '#527FFF',
            igw: '#2E7D32',

            // Compute
            eks: '#FF9900',
            node: '#FF6F00',
            pod: '#FFA500',

            // Storage
            s3: '#569A31',
            ebs: '#527FFF',

            // Management
            cloudwatch: '#FF4F8B',
            secrets: '#DD344C',

            // Application
            api: '#FF6A88',
            neo4j: '#008CC1',
            phoenix: '#9C27B0',
            postgres: '#336791',

            // External
            internet: '#4CAF50',
            user: '#2196F3'
        };

        // Group definitions
        const groups = [
            // AWS Cloud
            {id: 'aws', x: 30, y: 100, width: 1440, height: 750, label: 'AWS CLOUD', class: 'vpc'},

            // VPC
            {id: 'vpc', x: 50, y: 140, width: 1000, height: 670, label: 'VPC (10.0.0.0/16)', class: 'vpc'},

            // Public Subnet
            {id: 'public', x: 70, y: 190, width: 350, height: 200, label: 'PUBLIC SUBNET', class: 'subnet'},

            // Private Subnet
            {id: 'private', x: 70, y: 420, width: 960, height: 360, label: 'PRIVATE SUBNET', class: 'subnet'},

            // EKS Cluster
            {id: 'eks-cluster', x: 90, y: 460, width: 920, height: 290, label: 'EKS CLUSTER (Kubernetes 1.28)', class: 'cluster'},

            // AWS Managed Services
            {id: 'services', x: 1080, y: 140, width: 390, height: 670, label: 'AWS MANAGED SERVICES', class: 'services'}
        ];

        // Draw groups
        svg.selectAll('.group-box')
            .data(groups)
            .enter().append('rect')
            .attr('class', d => `group-box ${d.class}`)
            .attr('x', d => d.x)
            .attr('y', d => d.y)
            .attr('width', d => d.width)
            .attr('height', d => d.height);

        svg.selectAll('.group-label')
            .data(groups)
            .enter().append('text')
            .attr('class', d => `group-label ${d.class}`)
            .attr('x', d => d.x + 10)
            .attr('y', d => d.y - 8)
            .text(d => d.label);

        // Node definitions
        const nodes = [
            // Internet
            {id: 'internet', x: 120, y: 800, width: 140, height: 60, label: 'Internet\nUsers', color: colors.user, shape: 'hexagon'},
            {id: 'igw', x: 150, y: 110, width: 80, height: 50, label: 'Internet\nGateway', color: colors.igw},

            // Public Subnet Components
            {id: 'alb', x: 180, y: 240, width: 140, height: 60, label: 'Application\nLoad Balancer', color: colors.alb},
            {id: 'nat', x: 200, y: 320, width: 100, height: 50, label: 'NAT\nGateway', color: colors.nat},

            // EKS Control Plane (logical)
            {id: 'eks-control', x: 470, y: 240, width: 180, height: 60, label: 'EKS Control Plane\n(AWS Managed)', color: colors.eks},

            // Worker Nodes
            {id: 'node1', x: 120, y: 500, width: 180, height: 70, label: 'Worker Node 1\nt3.medium', color: colors.node},
            {id: 'node2', x: 320, y: 500, width: 180, height: 70, label: 'Worker Node 2\nt3.medium', color: colors.node},

            // Pods on Node 1
            {id: 'api-pod1', x: 130, y: 600, width: 80, height: 60, label: 'API Pod\n(FastAPI)', color: colors.api},
            {id: 'api-pod2', x: 220, y: 600, width: 80, height: 60, label: 'API Pod\n(FastAPI)', color: colors.api},

            // Pods on Node 2
            {id: 'neo4j-pod', x: 330, y: 600, width: 80, height: 60, label: 'Neo4j\nPod', color: colors.neo4j, shape: 'cylinder'},
            {id: 'phoenix-pod', x: 420, y: 600, width: 80, height: 60, label: 'Phoenix\nPod', color: colors.phoenix},

            // Storage
            {id: 'postgres-pod', x: 540, y: 600, width: 90, height: 60, label: 'PostgreSQL\nPod', color: colors.postgres, shape: 'cylinder'},
            {id: 'ebs', x: 700, y: 600, width: 120, height: 60, label: 'EBS Volumes\n(Persistent)', color: colors.ebs, shape: 'cylinder'},

            // AWS Managed Services
            {id: 's3', x: 1110, y: 200, width: 150, height: 60, label: 'S3 Bucket\n(Documents)', color: colors.s3, shape: 'cylinder'},
            {id: 'ecr', x: 1110, y: 280, width: 150, height: 60, label: 'ECR\n(Container Images)', color: colors.eks, shape: 'cylinder'},
            {id: 'cloudwatch', x: 1110, y: 400, width: 150, height: 60, label: 'CloudWatch\nLogs & Metrics', color: colors.cloudwatch},
            {id: 'secrets', x: 1290, y: 400, width: 150, height: 60, label: 'Secrets\nManager', color: colors.secrets},
            {id: 'cloudtrail', x: 1110, y: 480, width: 150, height: 60, label: 'CloudTrail\n(Audit Logs)', color: colors.secrets}
        ];

        // Draw nodes
        const nodeGroup = svg.selectAll('.node')
            .data(nodes)
            .enter().append('g')
            .attr('class', 'node')
            .attr('transform', d => `translate(${d.x}, ${d.y})`);

        nodeGroup.each(function(d) {
            const node = d3.select(this);

            if (d.shape === 'cylinder') {
                // Cylinder shape (databases/storage)
                const rx = d.width / 2;
                const ry = 8;

                node.append('ellipse')
                    .attr('cx', d.width / 2)
                    .attr('cy', ry)
                    .attr('rx', rx)
                    .attr('ry', ry)
                    .attr('fill', d.color)
                    .attr('stroke', d3.rgb(d.color).darker(0.5))
                    .attr('stroke-width', 2);

                node.append('rect')
                    .attr('x', 0)
                    .attr('y', ry)
                    .attr('width', d.width)
                    .attr('height', d.height - ry)
                    .attr('fill', d.color)
                    .attr('stroke', d3.rgb(d.color).darker(0.5))
                    .attr('stroke-width', 2);

                node.append('ellipse')
                    .attr('cx', d.width / 2)
                    .attr('cy', d.height)
                    .attr('rx', rx)
                    .attr('ry', ry)
                    .attr('fill', d.color)
                    .attr('stroke', d3.rgb(d.color).darker(0.5))
                    .attr('stroke-width', 2);

            } else if (d.shape === 'hexagon') {
                // Hexagon shape (external services)
                const points = [
                    [20, 0],
                    [d.width - 20, 0],
                    [d.width, d.height / 2],
                    [d.width - 20, d.height],
                    [20, d.height],
                    [0, d.height / 2]
                ];

                node.append('polygon')
                    .attr('points', points.map(p => p.join(',')).join(' '))
                    .attr('fill', d.color)
                    .attr('stroke', d3.rgb(d.color).darker(0.5))
                    .attr('stroke-width', 2);

            } else {
                // Rectangle (default)
                node.append('rect')
                    .attr('width', d.width)
                    .attr('height', d.height)
                    .attr('rx', 8)
                    .attr('fill', d.color)
                    .attr('stroke', d3.rgb(d.color).darker(0.5))
                    .attr('stroke-width', 2);
            }

            // Add text
            const lines = d.label.split('\n');
            const textGroup = node.append('text')
                .attr('x', d.width / 2)
                .attr('y', d.height / 2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'central')
                .attr('fill', 'white')
                .attr('font-size', '11px');

            const lineHeight = 13;
            const startY = -(lines.length - 1) * lineHeight / 2;
            lines.forEach((line, i) => {
                textGroup.append('tspan')
                    .attr('x', d.width / 2)
                    .attr('dy', i === 0 ? startY : lineHeight)
                    .text(line);
            });
        });

        // Links
        const links = [
            // Internet flow
            {from: 'internet', to: 'igw', type: 'solid'},
            {from: 'igw', to: 'alb', type: 'solid'},
            {from: 'alb', to: 'eks-control', type: 'solid'},

            // EKS Control Plane to Nodes
            {from: 'eks-control', to: 'node1', type: 'dashed'},
            {from: 'eks-control', to: 'node2', type: 'dashed'},

            // Nodes to Pods
            {from: 'node1', to: 'api-pod1', type: 'solid'},
            {from: 'node1', to: 'api-pod2', type: 'solid'},
            {from: 'node2', to: 'neo4j-pod', type: 'solid'},
            {from: 'node2', to: 'phoenix-pod', type: 'solid'},
            {from: 'node2', to: 'postgres-pod', type: 'solid'},

            // Pods to Storage
            {from: 'neo4j-pod', to: 'ebs', type: 'solid'},
            {from: 'postgres-pod', to: 'ebs', type: 'solid'},

            // API pods to Neo4j
            {from: 'api-pod1', to: 'neo4j-pod', type: 'dashed'},
            {from: 'api-pod2', to: 'neo4j-pod', type: 'dashed'},

            // NAT Gateway
            {from: 'node1', to: 'nat', type: 'dashed'},
            {from: 'nat', to: 'igw', type: 'dashed'},

            // Nodes to AWS Services
            {from: 'node1', to: 's3', type: 'solid'},
            {from: 'node1', to: 'secrets', type: 'dashed'},
            {from: 'node1', to: 'cloudwatch', type: 'dashed'},

            // ECR to Nodes
            {from: 'ecr', to: 'node1', type: 'dashed'},

            // Audit
            {from: 'alb', to: 'cloudtrail', type: 'dashed'}
        ];

        // Draw links
        const linkGroup = svg.insert('g', '.node')
            .attr('class', 'links');

        links.forEach(link => {
            const source = nodes.find(n => n.id === link.from);
            const target = nodes.find(n => n.id === link.to);

            if (!source || !target) return;

            const x1 = source.x + source.width / 2;
            const y1 = source.y + source.height / 2;
            const x2 = target.x + target.width / 2;
            const y2 = target.y + target.height / 2;

            // Calculate path with bezier curves
            const path = d3.path();
            path.moveTo(x1, y1);

            const dx = x2 - x1;
            const dy = y2 - y1;

            if (Math.abs(dx) > Math.abs(dy)) {
                // Horizontal curve
                const cx = x1 + dx / 2;
                path.quadraticCurveTo(cx, y1, cx, (y1 + y2) / 2);
                path.quadraticCurveTo(cx, y2, x2, y2);
            } else {
                // Vertical curve
                const cy = y1 + dy / 2;
                path.quadraticCurveTo(x1, cy, (x1 + x2) / 2, cy);
                path.quadraticCurveTo(x2, cy, x2, y2);
            }

            linkGroup.append('path')
                .attr('class', `link ${link.type}`)
                .attr('d', path.toString())
                .attr('marker-end', `url(#arrow${link.type === 'dashed' ? '-dashed' : ''})`);
        });

        // Add AWS logo text
        svg.append('text')
            .attr('class', 'aws-icon')
            .attr('x', 1400)
            .attr('y', 840)
            .attr('text-anchor', 'end')
            .text('Powered by AWS');
    </script>
</body>
</html>
